<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property Listings - Flat Finder Landlord</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/listings.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <script>
    // Define toggleProfilePopup in global scope
    function toggleProfilePopup() {
      const profilePopup = document.querySelector('.profile-popup');
      const profileOverlay = document.querySelector('.profile-popup-overlay');
      
      profilePopup.classList.toggle('active');
      profileOverlay.classList.toggle('active');
      
      if (profilePopup.classList.contains('active')) {
        document.getElementById('profile-name').focus();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Profile popup functionality
      const userProfile = document.querySelector('.user-profile');
      const profilePopup = document.querySelector('.profile-popup');
      const profileOverlay = document.querySelector('.profile-popup-overlay');
      const closeProfileBtn = profilePopup.querySelector('.close-popup');
      const profileForm = document.querySelector('.profile-form');
      const profileName = document.getElementById('profile-name');
      const profileEmail = document.getElementById('profile-email');
      const profilePhone = document.getElementById('profile-phone');
      const avatarPlaceholders = document.querySelectorAll('.avatar-placeholder');
      const userNameElements = document.querySelectorAll('.user-name');
      const userEmailElements = document.querySelectorAll('.user-email');

      userProfile.addEventListener('click', toggleProfilePopup);
      closeProfileBtn.addEventListener('click', toggleProfilePopup);
      profileOverlay.addEventListener('click', toggleProfilePopup);

      function updateProfileDisplay(name, email) {
        const initials = name.split(' ').map(n => n[0]).join('');
        
        // Update all instances of the profile information
        avatarPlaceholders.forEach(placeholder => {
          placeholder.textContent = initials;
        });
        
        userNameElements.forEach(element => {
          element.textContent = name;
        });
        
        userEmailElements.forEach(element => {
          element.textContent = email;
        });
      }

      profileForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = profileName.value.trim();
        const email = profileEmail.value.trim();
        
        updateProfileDisplay(name, email);
        toggleProfilePopup();
      });

      // Edit listing functionality
      const editBtns = document.querySelectorAll('.edit-btn');
      const editPopup = document.querySelector('.edit-listing-popup');
      const editOverlay = document.querySelector('.edit-popup-overlay');
      const closeEditBtn = document.querySelector('.close-edit-popup');
      
      // Preview functionality
      const previewBtns = document.querySelectorAll('.preview-btn');
      const previewPopup = document.querySelector('.preview-popup');
      const previewOverlay = document.querySelector('.preview-popup-overlay');
      const closePreviewBtn = document.querySelector('.close-preview');
      const carouselContainer = document.querySelector('.carousel-container');
      const carouselSlides = document.querySelectorAll('.carousel-slide');
      const prevSlideBtn = document.querySelector('.carousel-btn.prev');
      const nextSlideBtn = document.querySelector('.carousel-btn.next');
      const imageDots = document.querySelector('.image-dots');
      
      let currentSlide = 0;
      
      function updateCarousel() {
        carouselSlides.forEach((slide, index) => {
          slide.classList.toggle('active', index === currentSlide);
        });
        
        // Update dots
        const dots = imageDots.querySelectorAll('.dot');
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index === currentSlide);
        });
      }
      
      function createDots() {
        imageDots.innerHTML = '';
        carouselSlides.forEach((_, index) => {
          const dot = document.createElement('div');
          dot.className = `dot ${index === currentSlide ? 'active' : ''}`;
          dot.addEventListener('click', () => {
            currentSlide = index;
            updateCarousel();
          });
          imageDots.appendChild(dot);
        });
      }
      
      prevSlideBtn.addEventListener('click', () => {
        currentSlide = (currentSlide - 1 + carouselSlides.length) % carouselSlides.length;
        updateCarousel();
      });
      
      nextSlideBtn.addEventListener('click', () => {
        currentSlide = (currentSlide + 1) % carouselSlides.length;
        updateCarousel();
      });
      
      function togglePreviewPopup() {
        previewPopup.classList.toggle('active');
        previewOverlay.classList.toggle('active');
        if (previewPopup.classList.contains('active')) {
          createDots();
        }
      }
      
      previewBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const card = btn.closest('.property-card');
          populatePreview(card);
          togglePreviewPopup();
        });
      });
      
      function populatePreview(card) {
        const address = card.querySelector('.property-address').textContent;
        const price = card.querySelector('.property-price').textContent;
        const beds = card.querySelector('.bed-icon').nextElementSibling.textContent;
        const baths = card.querySelector('.shower-icon').nextElementSibling.textContent;
        const parking = card.querySelector('.car-icon').nextElementSibling.textContent;
        
        previewPopup.querySelector('.preview-address').textContent = address;
        previewPopup.querySelector('.preview-price').textContent = price;
        previewPopup.querySelector('.bed-icon').nextElementSibling.textContent = beds;
        previewPopup.querySelector('.shower-icon').nextElementSibling.textContent = baths;
        previewPopup.querySelector('.car-icon').nextElementSibling.textContent = parking;
      }
      
      closePreviewBtn.addEventListener('click', togglePreviewPopup);
      previewOverlay.addEventListener('click', togglePreviewPopup);
      
      const galleryContainer = document.querySelector('.gallery-container');
      const prevBtn = document.querySelector('.scroll-btn.prev');
      const nextBtn = document.querySelector('.scroll-btn.next');
      const thumbnailsContainer = document.querySelector('.gallery-thumbnails');
      
      function toggleEditPopup() {
        editPopup.classList.toggle('active');
        editOverlay.classList.toggle('active');
      }
      
      editBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const card = btn.closest('.property-card');
          populateEditForm(card);
          toggleEditPopup();
        });
      });
      
      closeEditBtn.addEventListener('click', toggleEditPopup);
      editOverlay.addEventListener('click', toggleEditPopup);
      
      // Image gallery navigation
      let currentImageIndex = 0;
      const images = document.querySelectorAll('.gallery-image');
      
      function updateGallery() {
        images.forEach((img, index) => {
          img.classList.toggle('active', index === currentImageIndex);
          const thumbnail = document.createElement('div');
          thumbnail.className = `gallery-thumbnail ${index === currentImageIndex ? 'active' : ''}`;
          thumbnail.style.backgroundImage = img.style.backgroundImage;
          thumbnail.addEventListener('click', () => {
            currentImageIndex = index;
            updateGallery();
          });
          thumbnailsContainer.appendChild(thumbnail);
        });
      }
      
      prevBtn.addEventListener('click', () => {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        updateGallery();
      });
      
      nextBtn.addEventListener('click', () => {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        updateGallery();
      });
      
      function populateEditForm(card) {
        // Populate form fields with existing data
        document.getElementById('edit-address').value = card.querySelector('.property-address').textContent;
        document.getElementById('edit-rent').value = card.querySelector('.property-price').textContent.match(/\d+/)[0];
        document.getElementById('edit-bedrooms').value = card.querySelector('.bed-icon').nextElementSibling.textContent.match(/\d+/)[0];
        document.getElementById('edit-bathrooms').value = card.querySelector('.shower-icon').nextElementSibling.textContent.match(/\d+/)[0];
        document.getElementById('edit-parking').value = card.querySelector('.car-icon').nextElementSibling.textContent.match(/\d+/)[0];
        
        // Reset gallery
        currentImageIndex = 0;
        thumbnailsContainer.innerHTML = '';
        updateGallery();
      }
      
      const addListingBtn = document.querySelector('.add-listing-btn');
      const popup = document.querySelector('.add-listing-popup');
      const overlay = document.querySelector('.popup-overlay');
      const closeBtn = document.querySelector('.close-popup');
      const listingForm = document.querySelector('.listing-form');

      const togglePopup = () => {
        popup.classList.toggle('active');
        overlay.classList.toggle('active');
      };

      addListingBtn.addEventListener('click', togglePopup);
      closeBtn.addEventListener('click', togglePopup);
      overlay.addEventListener('click', togglePopup);

      listingForm.addEventListener('submit', (e) => {
        e.preventDefault();
        // Here you would typically handle the form submission
        // For now, we'll just close the popup
        togglePopup();
      });
    });
  </script>
</body>
</html>