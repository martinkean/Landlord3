<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Applications - Flat Finder Landlord</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/applications.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="house-icon">
            <div class="roof"></div>
            <div class="base"></div>
          </div>
          <h1>FLAT FINDER LANDLORD</h1>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <a href="index.html" class="nav-item">
          <div class="nav-icon dashboard-icon"></div>
          <span>Dashboard</span>
        </a>
        <a href="listings.html" class="nav-item">
          <div class="nav-icon listings-icon"></div>
          <span>Listings</span>
        </a>
        <a href="applications.html" class="nav-item active">
          <div class="nav-icon applications-icon"></div>
          <span>Applications</span>
        </a>
        <a href="calendar.html" class="nav-item">
          <div class="nav-icon calendar-icon"></div>
          <span>Calendar</span>
        </a>
        <a href="messages.html" class="nav-item">
          <div class="nav-icon messages-icon"></div>
          <span>Messages</span>
        </a>
        <a href="analytics.html" class="nav-item">
          <div class="nav-icon analytics-icon"></div>
          <span>Analytics</span>
        </a>
        <a href="#" class="nav-item logout">
          <div class="nav-icon logout-icon"></div>
          <span>Log out</span>
        </a>
      </nav>
      
      <div class="user-profile" role="button" tabindex="0" onclick="toggleProfilePopup()">
        <div class="avatar">
          <div class="avatar-placeholder">AJ</div>
        </div>
        <div class="user-info">
          <h3 class="user-name">Andrew James</h3>
          <p class="user-email">AJ@cutlers.co.nz</p>
        </div>
      </div>
    </aside>
    
    <!-- Profile Edit Popup -->
    <div class="profile-popup-overlay"></div>
    <div class="profile-popup">
      <div class="popup-header">
        <h2>Edit Profile</h2>
        <button class="close-popup">&times;</button>
      </div>
      <form class="profile-form">
        <div class="profile-avatar-upload">
          <div class="profile-avatar-preview">AJ</div>
          <label class="upload-btn">
            Upload Photo
            <input type="file" accept="image/*" style="display: none;">
          </label>
        </div>
        <div class="form-group">
          <label for="profile-name">Full Name</label>
          <input type="text" id="profile-name" value="Andrew James" required>
        </div>
        <div class="form-group">
          <label for="profile-email">Email</label>
          <input type="email" id="profile-email" value="AJ@cutlers.co.nz" required>
        </div>
        <div class="form-group">
          <label for="profile-phone">Phone Number</label>
          <input type="tel" id="profile-phone" placeholder="Enter phone number">
        </div>
        <button type="submit" class="submit-btn">Save Changes</button>
      </form>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="page-header">
        <h1 class="page-title">Applications</h1>
      </div>
      
      <div class="tabs">
        <div class="tab active" data-status="new">New (2)</div>
        <div class="tab" data-status="in-progress">In Progress (3)</div>
        <div class="tab" data-status="approved">Approved (4)</div>
        <div class="tab" data-status="declined">Declined (1)</div>
      </div>
      
      <div class="applications-container">
        <!-- Application Card 1 -->
        <div class="application-card" data-status="new">
          <div class="application-header">
            <h3 class="property-name">33 Bedford Street</h3>
            <div class="application-status new">New</div>
          </div>
          
          <div class="applicants">
            <div class="primary-applicant">
              <div class="applicant-avatar">
                <div class="avatar-placeholder">CB</div>
              </div>
              <div class="applicant-info">
                <h4>Charlie Brown</h4>
                <p>+ 5 others</p>
              </div>
            </div>
            
            <div class="application-meta">
              <div class="meta-item">
                <div class="meta-icon document-icon"></div>
                <span>6 tenants</span>
              </div>
              <div class="meta-item">
                <div class="meta-icon calendar-small-icon"></div>
                <span>Submitted 1 day ago</span>
              </div>
            </div>
          </div>
          
          <div class="application-actions">
            <button class="review-btn">Review Application</button>
            <button class="schedule-btn">Schedule Interview</button>
          </div>
        </div>
        
        <!-- Application Card 2 -->
        <div class="application-card" data-status="new">
          <div class="application-header">
            <h3 class="property-name">78 George Street</h3>
            <div class="application-status new">New</div>
          </div>
          
          <div class="applicants">
            <div class="primary-applicant">
              <div class="applicant-avatar">
                <div class="avatar-placeholder">JD</div>
              </div>
              <div class="applicant-info">
                <h4>Jane Dough</h4>
                <p>+ 3 others</p>
              </div>
            </div>
            
            <div class="application-meta">
              <div class="meta-item">
                <div class="meta-icon document-icon"></div>
                <span>4 tenants</span>
              </div>
              <div class="meta-item">
                <div class="meta-icon calendar-small-icon"></div>
                <span>Submitted 2 days ago</span>
              </div>
            </div>
          </div>
          
          <div class="application-actions">
            <button class="review-btn">Review Application</button>
            <button class="schedule-btn">Schedule Interview</button>
          </div>
        </div>
        
        <!-- Application Card 3 (In Progress) -->
        <div class="application-card" data-status="in-progress">
          <div class="application-header">
            <h3 class="property-name">123 Castle Street</h3>
            <div class="application-status in-progress">In Progress</div>
          </div>
          
          <div class="applicants">
            <div class="primary-applicant">
              <div class="applicant-avatar">
                <div class="avatar-placeholder">TS</div>
              </div>
              <div class="applicant-info">
                <h4>Tom Smith</h4>
                <p>+ 2 others</p>
              </div>
            </div>
            
            <div class="application-meta">
              <div class="meta-item">
                <div class="meta-icon document-icon"></div>
                <span>3 tenants</span>
              </div>
              <div class="meta-item">
                <div class="meta-icon calendar-small-icon"></div>
                <span>Interview scheduled</span>
              </div>
            </div>
          </div>
          
          <div class="application-actions">
            <button class="review-btn">Review Application</button>
            <button class="schedule-btn">Reschedule Interview</button>
          </div>
        </div>
        
        <!-- Application Card 4 (Approved) -->
        <div class="application-card" data-status="approved">
          <div class="application-header">
            <h3 class="property-name">45 Dundas Street</h3>
            <div class="application-status approved">Approved</div>
          </div>
          
          <div class="applicants">
            <div class="primary-applicant">
              <div class="applicant-avatar">
                <div class="avatar-placeholder">LW</div>
              </div>
              <div class="applicant-info">
                <h4>Lucy Wilson</h4>
                <p>+ 4 others</p>
              </div>
            </div>
            
            <div class="application-meta">
              <div class="meta-item">
                <div class="meta-icon document-icon"></div>
                <span>5 tenants</span>
              </div>
              <div class="meta-item">
                <div class="meta-icon calendar-small-icon"></div>
                <span>Move in: July 1st</span>
              </div>
            </div>
          </div>
          
          <div class="application-actions">
            <button class="review-btn">View Details</button>
          </div>
        </div>
        
        <!-- Application Card 5 (Declined) -->
        <div class="application-card" data-status="declined">
          <div class="application-header">
            <h3 class="property-name">89 George Street</h3>
            <div class="application-status declined">Declined</div>
          </div>
          
          <div class="applicants">
            <div class="primary-applicant">
              <div class="applicant-avatar">
                <div class="avatar-placeholder">RB</div>
              </div>
              <div class="applicant-info">
                <h4>Ryan Brown</h4>
                <p>+ 1 other</p>
              </div>
            </div>
            
            <div class="application-meta">
              <div class="meta-item">
                <div class="meta-icon document-icon"></div>
                <span>2 tenants</span>
              </div>
              <div class="meta-item">
                <div class="meta-icon calendar-small-icon"></div>
                <span>Declined 3 days ago</span>
              </div>
            </div>
          </div>
          
          <div class="application-actions">
            <button class="review-btn">View Details</button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Review Application Popup -->
    <div class="popup-overlay review-overlay"></div>
    <div class="popup review-popup">
      <div class="popup-header">
        <h2>Review Application</h2>
        <button class="close-popup">&times;</button>
      </div>
      <div class="popup-content">
        <div class="application-details">
          <h3>Property Details</h3>
          <p class="property-address"></p>
          <p class="weekly-rent">Weekly Rent: $1,250</p>
          
          <h3>Applicants</h3>
          <div class="applicants-list">
            <!-- Will be populated dynamically -->
          </div>
          
          <h3>References</h3>
          <div class="references">
            <div class="reference">
              <h4>Previous Landlord</h4>
              <p>Name: John Smith</p>
              <p>Phone: (03) 123-4567</p>
              <p>Email: john@email.com</p>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="approve-btn">Approve Application</button>
            <button class="decline-btn">Decline Application</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Schedule Interview Popup -->
    <div class="popup-overlay schedule-overlay"></div>
    <div class="popup schedule-popup">
      <div class="popup-header">
        <h2>Schedule Interview</h2>
        <button class="close-popup">&times;</button>
      </div>
      <div class="popup-content">
        <form class="schedule-form">
          <div class="form-group">
            <label for="interview-date">Date & Time</label>
            <input type="text" id="interview-date" class="datetime-picker" required>
          </div>
          <div class="form-group">
            <label for="interview-location">Location</label>
            <select id="interview-location" required>
              <option value="property">At the Property</option>
              <option value="office">At Our Office</option>
              <option value="online">Online (Zoom)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="interview-notes">Notes</label>
            <textarea id="interview-notes" rows="3" placeholder="Any additional information..."></textarea>
          </div>
          <button type="submit" class="submit-btn">Schedule Interview</button>
        </form>
      </div>
    </div>
    
    <!-- View Details Popup -->
    <div class="popup-overlay details-overlay"></div>
    <div class="popup details-popup">
      <div class="popup-header">
        <h2>Application Details</h2>
        <button class="close-popup">&times;</button>
      </div>
      <div class="popup-content">
        <div class="application-details">
          <div class="status-banner">
            <span class="status-label"></span>
            <span class="status-date"></span>
          </div>
          
          <h3>Property Details</h3>
          <p class="property-address"></p>
          
          <h3>Applicants</h3>
          <div class="applicants-list">
            <!-- Will be populated dynamically -->
          </div>
          
          <h3>Application Timeline</h3>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-date">June 26, 2025</div>
              <div class="timeline-content">Application submitted</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-date">June 27, 2025</div>
              <div class="timeline-content">Interview scheduled</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-date">June 28, 2025</div>
              <div class="timeline-content">References checked</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Profile popup functionality
        const userProfile = document.querySelector('.user-profile');
        const profilePopup = document.querySelector('.profile-popup');
        const profileOverlay = document.querySelector('.profile-popup-overlay');
        const closeProfileBtn = profilePopup.querySelector('.close-popup');
        const profileForm = document.querySelector('.profile-form');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        const profilePhone = document.getElementById('profile-phone');
        const avatarPlaceholders = document.querySelectorAll('.avatar-placeholder');
        const userNameElements = document.querySelectorAll('.user-name');
        const userEmailElements = document.querySelectorAll('.user-email');

        function toggleProfilePopup() {
          profilePopup.classList.toggle('active');
          profileOverlay.classList.toggle('active');
          
          if (profilePopup.classList.contains('active')) {
            profileName.focus();
          }
        }

        userProfile.addEventListener('click', toggleProfilePopup);
        closeProfileBtn.addEventListener('click', toggleProfilePopup);
        profileOverlay.addEventListener('click', toggleProfilePopup);

        function updateProfileDisplay(name, email) {
          const initials = name.split(' ').map(n => n[0]).join('');
          
          // Update all instances of the profile information
          avatarPlaceholders.forEach(placeholder => {
            placeholder.textContent = initials;
          });
          
          userNameElements.forEach(element => {
            element.textContent = name;
          });
          
          userEmailElements.forEach(element => {
            element.textContent = email;
          });
        }

        profileForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const name = profileName.value.trim();
          const email = profileEmail.value.trim();
          
          updateProfileDisplay(name, email);
          toggleProfilePopup();
        });

        const tabs = document.querySelectorAll('.tab');
        const applications = document.querySelectorAll('.application-card');
        const reviewBtns = document.querySelectorAll('.review-btn');
        const scheduleBtns = document.querySelectorAll('.schedule-btn');
        const closeButtons = document.querySelectorAll('.close-popup');
        const overlays = document.querySelectorAll('.popup-overlay');
        const reviewPopup = document.querySelector('.review-popup');
        const schedulePopup = document.querySelector('.schedule-popup');
        const detailsPopup = document.querySelector('.details-popup');
        const approveBtns = document.querySelectorAll('.approve-btn');
        const declineBtns = document.querySelectorAll('.decline-btn');
        
        // Add the missing populateReviewPopup function
        function populateReviewPopup(card) {
          // Remove active class from all cards
          applications.forEach(app => app.classList.remove('active'));
          // Add active class to current card
          card.classList.add('active');
          
          // Populate property details
          const propertyName = card.querySelector('.property-name').textContent;
          reviewPopup.querySelector('.property-address').textContent = propertyName;
          
          // Populate applicants list
          const applicantsList = reviewPopup.querySelector('.applicants-list');
          applicantsList.innerHTML = ''; // Clear existing applicants
          
          const primaryApplicant = card.querySelector('.primary-applicant');
          const applicantName = primaryApplicant.querySelector('h4').textContent;
          const otherApplicants = primaryApplicant.querySelector('p').textContent;
          
          const applicantDiv = document.createElement('div');
          applicantDiv.className = 'applicant';
          applicantDiv.innerHTML = `
            <h4>Primary Applicant: ${applicantName}</h4>
            <p>Additional Applicants: ${otherApplicants}</p>
          `;
          applicantsList.appendChild(applicantDiv);
        }
        
        // Add the missing populateDetailsPopup function
        function populateDetailsPopup(card) {
          // Remove active class from all cards
          applications.forEach(app => app.classList.remove('active'));
          // Add active class to current card
          card.classList.add('active');
          
          // Populate property details
          const propertyName = card.querySelector('.property-name').textContent;
          detailsPopup.querySelector('.property-address').textContent = propertyName;
          
          // Set status information
          const status = card.querySelector('.application-status').textContent;
          const statusLabel = detailsPopup.querySelector('.status-label');
          statusLabel.textContent = status;
          statusLabel.className = `status-label ${status.toLowerCase()}`;
          
          // Populate applicants list
          const applicantsList = detailsPopup.querySelector('.applicants-list');
          applicantsList.innerHTML = ''; // Clear existing applicants
          
          const primaryApplicant = card.querySelector('.primary-applicant');
          const applicantName = primaryApplicant.querySelector('h4').textContent;
          const otherApplicants = primaryApplicant.querySelector('p').textContent;
          
          const applicantDiv = document.createElement('div');
          applicantDiv.className = 'applicant';
          applicantDiv.innerHTML = `
            <h4>Primary Applicant: ${applicantName}</h4>
            <p>Additional Applicants: ${otherApplicants}</p>
          `;
          applicantsList.appendChild(applicantDiv);
        }

        function showApplications(status) {
          applications.forEach(app => {
            if (app.dataset.status === status) {
              app.style.display = 'block';
            } else {
              app.style.display = 'none';
            }
          });
        }
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            showApplications(tab.dataset.status);
          });
        });
        
        showApplications('new');
        
        flatpickr(".datetime-picker", {
          enableTime: true,
          dateFormat: "Y-m-d H:i",
          minDate: "today",
          time_24hr: true
        });
        
        function openPopup(popup, overlay) {
          popup.classList.add('active');
          overlay.classList.add('active');
        }
        
        function closePopup(popup, overlay) {
          popup.classList.remove('active');
          overlay.classList.remove('active');
        }
        
        function closeAllPopups() {
          document.querySelectorAll('.popup').forEach(popup => {
            popup.classList.remove('active');
          });
          document.querySelectorAll('.popup-overlay').forEach(overlay => {
            overlay.classList.remove('active');
          });
        }
        
        reviewBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const card = btn.closest('.application-card');
            const status = card.dataset.status;
            
            if (status === 'approved' || status === 'declined') {
              const detailsOverlay = document.querySelector('.details-overlay');
              populateDetailsPopup(card);
              openPopup(detailsPopup, detailsOverlay);
            } else {
              const reviewOverlay = document.querySelector('.review-overlay');
              populateReviewPopup(card);
              openPopup(reviewPopup, reviewOverlay);
            }
          });
        });
        
        scheduleBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const scheduleOverlay = document.querySelector('.schedule-overlay');
            openPopup(schedulePopup, scheduleOverlay);
          });
        });
        
        closeButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            closeAllPopups();
          });
        });
        
        overlays.forEach(overlay => {
          overlay.addEventListener('click', () => {
            closeAllPopups();
          });
        });
        
        document.querySelector('.schedule-form').addEventListener('submit', (e) => {
          e.preventDefault();
          const card = document.querySelector('.application-card[data-status="new"]');
          card.dataset.status = 'in-progress';
          card.querySelector('.application-status').className = 'application-status in-progress';
          card.querySelector('.application-status').textContent = 'In Progress';
          closeAllPopups();
          showApplications('in-progress');
          document.querySelector('[data-status="in-progress"]').click();
        });
        
        approveBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const card = document.querySelector('.application-card.active');
            card.dataset.status = 'approved';
            card.querySelector('.application-status').className = 'application-status approved';
            card.querySelector('.application-status').textContent = 'Approved';
            closeAllPopups();
            showApplications('approved');
            document.querySelector('[data-status="approved"]').click();
          });
        });
        
        declineBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const card = document.querySelector('.application-card.active');
            card.dataset.status = 'declined';
            card.querySelector('.application-status').className = 'application-status declined';
            card.querySelector('.application-status').textContent = 'Declined';
            closeAllPopups();
            showApplications('declined');
            document.querySelector('[data-status="declined"]').click();
          });
        });
      });
    </script>
  </div>
</body>
</html>